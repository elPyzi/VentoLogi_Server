generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Companies {
  id         Int        @id @default(autoincrement())
  name       String     @db.VarChar(100)
  address    String?
  phone      String?    @db.VarChar(20)
  deliveries Delivery[]

  @@map("companies")
}

model Delivery {
  id             Int               @id @default(autoincrement())
  name           String            @db.VarChar(100)
  status_id      Int?
  start          DateTime?         @db.Timestamp(6)
  finish         DateTime?         @db.Timestamp(6)
  total_cost     Decimal?          @db.Decimal
  transport_id   Int?
  company_id     Int?
  dock_id        Int?
  company        Companies?        @relation(fields: [company_id], references: [id])
  dock           Dock?             @relation(fields: [dock_id], references: [id])
  deliveryStatus DeliveryStatuses? @relation(fields: [status_id], references: [id])
  transport      Transports?       @relation(fields: [transport_id], references: [id])
  flightLogs     FlightLog[]
  orders         Orders[]
  routePoints    RoutePoints[]

  @@map("deliveries")
}

model DeliveryStatuses {
  id         Int        @id @default(autoincrement())
  name       String     @unique @db.VarChar(50)
  deliveries Delivery[]

  @@map("delivery_statuses")
}

model Dock {
  id         Int                   @id @default(autoincrement())
  name       String                @unique @db.VarChar(100)
  geo_point  Unsupported("point")?
  city       String?               @db.VarChar(100)
  phone      String?               @db.VarChar(20)
  deliveries Delivery[]

  @@map("docks")
}

model FlightLog {
  id           Int         @id @default(autoincrement())
  transport_id Int?
  delivery_id  Int?
  start_time   DateTime?   @db.Timestamp(6)
  end_time     DateTime?   @db.Timestamp(6)
  max_load     Decimal?    @db.Decimal
  notes        String?
  delivery     Delivery?   @relation(fields: [delivery_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  transport    Transports? @relation(fields: [transport_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("flight_logs")
}

model MaintenanceLog {
  id               Int         @id @default(autoincrement())
  transport_id     Int?
  maintenance_date DateTime?   @db.Timestamp(6)
  description      String?
  next_due         DateTime?   @db.Timestamp(6)
  transport        Transports? @relation(fields: [transport_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("maintenance_logs")
}

model OrderStatuses {
  id     Int      @id @default(autoincrement())
  name   String   @unique @db.VarChar(50)
  orders Orders[]

  @@map("order_statuses")
}

model Orders {
  id           Int            @id @default(autoincrement())
  name         String         @db.VarChar(100)
  status_id    Int?
  cost         Decimal?       @db.Decimal
  weight       Decimal?       @db.Decimal
  created_at   DateTime?      @default(now()) @db.Timestamp(6)
  finish_at    DateTime?      @db.Timestamp(6)
  user_id      Int?
  delivery_id  Int?
  transportsId Int?
  deliveries   Delivery?      @relation(fields: [delivery_id], references: [id])
  orderStatus  OrderStatuses? @relation(fields: [status_id], references: [id])
  transports   Transports?    @relation(fields: [transportsId], references: [id])
  user         Users?         @relation(fields: [user_id], references: [id])

  @@map("orders")
}

model Roles {
  id    Int     @id @default(autoincrement())
  name  String  @unique @db.VarChar(50)
  users Users[]

  @@map("roles")
}

model RoutePoints {
  id           Int                  @id @default(autoincrement())
  delivery_id  Int?
  sequence_num Int
  location     Unsupported("point")
  eta          DateTime?            @db.Timestamp(6)
  delivery     Delivery?            @relation(fields: [delivery_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("route_points")
}

model Transports {
  id               Int              @id @default(autoincrement())
  name             String           @db.VarChar(100)
  type             String?          @db.VarChar(50)
  capacity_kg      Decimal?         @db.Decimal
  length           Decimal?         @db.Decimal
  width            Decimal?         @db.Decimal
  height           Decimal?         @db.Decimal
  speed            Decimal?         @db.Decimal
  fuel_type        String?          @db.VarChar(50)
  fuel_consumption Decimal?         @db.Decimal
  status           String?          @default("available") @db.VarChar(50)
  deliveries       Delivery[]
  flightLogs       FlightLog[]
  maintenanceLogs  MaintenanceLog[]
  orders           Orders[]

  @@map("transports")
}

model Users {
  id          Int       @id @default(autoincrement())
  login       String    @unique @db.VarChar(50)
  email       String    @unique @db.VarChar(100)
  phone       String?   @db.VarChar(20)
  password    String    @db.VarChar(255)
  full_name   String?   @db.VarChar(100)
  avatar      String?   @db.VarChar(255)
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  role_id     Int?
  client_type String?   @db.VarChar(20)
  orders      Orders[]
  role        Roles?    @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("users")
}

model WeatherCondition {
  id             Int                  @id @default(autoincrement())
  location       Unsupported("point")
  recorded_at    DateTime?            @default(now()) @db.Timestamp(6)
  wind_speed     Decimal?             @db.Decimal
  wind_direction Decimal?             @db.Decimal
  temperature    Decimal?             @db.Decimal
  pressure       Decimal?             @db.Decimal
  precipitation  Decimal?             @db.Decimal

  @@map("weather_conditions")
}

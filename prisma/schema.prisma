generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Company {
  id         Int        @id @default(autoincrement())
  name       String     @db.VarChar(100)
  address    String?
  phone      String?    @db.VarChar(20)
  deliveries Delivery[]

  @@map("companies")
}

model Delivery {
  id             Int             @id @default(autoincrement())
  name           String          @db.VarChar(100)
  status_id      Int?
  start          DateTime?       @db.Timestamp(6)
  finish         DateTime?       @db.Timestamp(6)
  total_cost     Decimal?        @db.Decimal
  transport_id   Int?
  dock_id        Int?
  company_id     Int?
  company        Company?        @relation(fields: [company_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  dock           Dock?           @relation(fields: [dock_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  deliveryStatus DeliveryStatus? @relation(fields: [status_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  transport      Transport?      @relation(fields: [transport_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  deliveryOrders DeliveryOrder[]
  flightLogs     FlightLog[]
  routePoints    RoutePoint[]

  @@map("deliveries")
}

model DeliveryOrder {
  delivery_id Int
  order_id    Int
  delivery    Delivery @relation(fields: [delivery_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  order       Order    @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([delivery_id, order_id])
  @@map("delivery_order")
}

model DeliveryStatus {
  id         Int        @id @default(autoincrement())
  name       String     @unique @db.VarChar(50)
  deliveries Delivery[]

  @@map("delivery_statuses")
}

model Dock {
  id         Int                   @id @default(autoincrement())
  name       String                @unique @db.VarChar(100)
  geo_point  Unsupported("point")?
  city       String?               @db.VarChar(100)
  phone      String?               @db.VarChar(20)
  deliveries Delivery[]

  @@map("docks")
}

model FlightLog {
  id           Int        @id @default(autoincrement())
  transport_id Int?
  delivery_id  Int?
  start_time   DateTime?  @db.Timestamp(6)
  end_time     DateTime?  @db.Timestamp(6)
  max_load     Decimal?   @db.Decimal
  notes        String?
  delivery     Delivery?  @relation(fields: [delivery_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  transport    Transport? @relation(fields: [transport_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("flight_logs")
}

model MaintenanceLog {
  id               Int        @id @default(autoincrement())
  transport_id     Int?
  maintenance_date DateTime?  @db.Timestamp(6)
  description      String?
  next_due         DateTime?  @db.Timestamp(6)
  transport        Transport? @relation(fields: [transport_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("maintenance_logs")
}

model OrderStatus {
  id     Int     @id @default(autoincrement())
  name   String  @unique @db.VarChar(50)
  orders Order[]

  @@map("order_statuses")
}

model Order {
  id             Int             @id @default(autoincrement())
  name           String          @db.VarChar(100)
  status_id      Int?
  transport_id   Int?
  cost           Decimal?        @db.Decimal
  created_at     DateTime?       @default(now()) @db.Timestamp(6)
  finish_at      DateTime?       @db.Timestamp(6)
  user_id        Int?
  deliveryOrders DeliveryOrder[]
  orderStatus    OrderStatus?    @relation(fields: [status_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  transport      Transport?      @relation(fields: [transport_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user           User?           @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("orders")
}

model Role {
  id    Int    @id @default(autoincrement())
  name  String @unique @db.VarChar(50)
  users User[]

  @@map("roles")
}

model RoutePoint {
  id           Int                  @id @default(autoincrement())
  delivery_id  Int?
  sequence_num Int
  location     Unsupported("point")
  eta          DateTime?            @db.Timestamp(6)
  delivery     Delivery?            @relation(fields: [delivery_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("route_points")
}

model Transport {
  id               Int              @id @default(autoincrement())
  name             String           @db.VarChar(100)
  type             String?          @db.VarChar(50)
  capacity_kg      Decimal?         @db.Decimal
  length           Decimal?         @db.Decimal
  width            Decimal?         @db.Decimal
  height           Decimal?         @db.Decimal
  speed            Decimal?         @db.Decimal
  fuel_type        String?          @db.VarChar(50)
  fuel_consumption Decimal?         @db.Decimal
  status           String?          @default("available") @db.VarChar(50)
  deliveries       Delivery[]
  flightLogs       FlightLog[]
  maintenanceLogs  MaintenanceLog[]
  orders           Order[]

  @@map("transports")
}

model User {
  id         Int       @id @default(autoincrement())
  login      String    @unique @db.VarChar(50)
  email      String    @unique @db.VarChar(100)
  phone      String?   @db.VarChar(20)
  password   String    @db.VarChar(255)
  full_name  String?   @db.VarChar(100)
  avatar     String?   @db.VarChar(255)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  role_id    Int?
  orders     Order[]
  role       Role?     @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("users")
}

model WeatherCondition {
  id             Int                  @id @default(autoincrement())
  location       Unsupported("point")
  recorded_at    DateTime?            @default(now()) @db.Timestamp(6)
  wind_speed     Decimal?             @db.Decimal
  wind_direction Decimal?             @db.Decimal
  temperature    Decimal?             @db.Decimal
  pressure       Decimal?             @db.Decimal
  precipitation  Decimal?             @db.Decimal

  @@map("weather_conditions")
}
